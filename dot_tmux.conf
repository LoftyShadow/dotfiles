# 解决 nvim 按 Esc 键的延迟
set -s escape-time 0

# 开启鼠标支持（方便你用鼠标调整分屏大小）
set -g mouse on
# 当销毁会话时，自动切换到另一个活跃会话，而不是退出 tmux
set -g detach-on-destroy off
# 开启窗口编号自动重新排序
set -g renumber-windows on

# 开启 copy-mode 的 vi 模式
setw -g mode-keys vi

# 类似 vim 的选中文本
bind-key -T copy-mode-vi v send-keys -X begin-selection
# 类似 vim 的复制文本到剪贴板 (需要 Fedora 安装了 xclip)
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -selection clipboard -i"

# 修改前缀键为 Ctrl+a
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# 使用更直观的分割快捷键
bind | split-window -h -c "#{pane_current_path}" # 竖分屏保持当前路径
bind - split-window -v -c "#{pane_current_path}" # 横分屏保持当前路径

# 使用vim风格的窗格切换
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
# 按 Prefix + N 直接创建新会话 (不询问名字，快速开启)
bind N new-session

# 快速创建新会话（会提示你输入名称）
bind-key C-c command-prompt -p "Window Name:" "new-session -s '%%'"
# 强行销毁当前会话并跳到下一个（慎用，类似强制关机）
bind-key Q confirm-before -p "Kill #S? (y/n)" "run-shell 'tmux switch-client -n \\; kill-session -t \"#S\"'"

# 快速重载配置文件
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# 设置状态栏样式
set -g status-bg black
set -g status-fg white
set -g status-left '#[fg=green]#S '
set -g status-right '#[fg=yellow]%Y-%m-%d %H:%M'
# 解决 nvim 在 tmux 中的颜色显示问题
set -g default-terminal "alacritty"
set -as terminal-overrides ",alacritty:Tc"

# --- 插件管理 (核心：自动恢复) ---
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'   # 保存/恢复
set -g @plugin 'tmux-plugins/tmux-continuum'   # 自动保存/自动恢复

# --- 插件进阶设置 ---
set -g @resurrect-strategy-nvim 'session'      # 完美恢复 nvim 会话状态
set -g @resurrect-capture-pane-contents 'on'   # 恢复窗格里的文字内容
set -g @continuum-restore 'on'                 # 启动 tmux 时自动执行 restore
set -g @continuum-save-interval '15'           # 每 15 分钟自动保存一次
set -g @plugin 'tmux-plugins/tmux-yank'        # 更完美地处理系统剪贴板，尤其是支持鼠标选中的瞬间自动复制。

# 初始化 TPM (必须在最后)
run '~/.tmux/plugins/tpm/tpm'
